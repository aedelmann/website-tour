{{ define "main" }}
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <article class="blog-post">
                <!-- Post Header -->
                <header class="mb-4">
                    <div class="mb-3">
                        {{ if .Params.category }}
                        <span class="badge bg-primary me-2">{{ .Params.category }}</span>
                        {{ end }}
                        {{ if .Params.location }}
                        <span class="badge bg-secondary me-2">{{ .Params.location }}</span>
                        {{ end }}
                        {{ if .Params.tags }}
                        {{ range .Params.tags }}
                        <span class="badge bg-light text-dark me-1">#{{ . }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                    <h1 class="display-5 fw-bold mb-3">{{ .Title }}</h1>
                    <div class="post-meta">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-calendar text-primary me-2"></i>
                                    <span class="me-4">{{ .Date.Format "January 2, 2006" }}</span>
                                    {{ if .Params.reading_time }}
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    <span>{{ .Params.reading_time }} min read</span>
                                    {{ end }}
                                </div>
                            </div>
                            <div class="col-md-6 text-md-end">
                                {{ if .Params.latitude }}
                                <a href="{{ "/map/" | relURL }}?lat={{ .Params.latitude }}&lng={{ .Params.longitude }}&zoom=10"
                                   class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-map-marker-alt me-1"></i>View on Map
                                </a>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Featured Image -->
                {{ if .Params.featured_image }}
                <img src="{{ .Params.featured_image | relURL }}" 
                     alt="{{ .Title }}" 
                     class="featured-image img-fluid rounded mb-4">
                {{ end }}

                <!-- Post Content -->
                <div class="post-content">
                    {{ .Content }}
                </div>

                <!-- Photo Gallery -->
                {{ if .Params.gallery }}
                <section class="mt-5">
                    <h3><i class="fas fa-images me-2"></i>Photo Gallery</h3>
                    <div class="photo-gallery">
                        {{ range .Params.gallery }}
                        <img src="{{ . | relURL }}" 
                             alt="Gallery image" 
                             role="button"
                             onclick="openGalleryModal(this.src)"
                             class="img-thumbnail me-2 mb-2"
                             style="width: 150px; height: 150px; object-fit: cover;">
                        {{ end }}
                    </div>
                    {{ if .Site.Params.instagram }}
                    <p class="text-center mt-3 mb-0">
                        <a href="https://instagram.com/{{ .Site.Params.instagram }}" target="_blank" rel="noopener" class="btn btn-outline-primary btn-sm">
                            <i class="fab fa-instagram me-1"></i>More photos on Instagram
                        </a>
                    </p>
                    {{ end }}
                </section>
                {{ end }}

                <!-- Navigation to other posts -->
                <nav class="mt-5">
                    <div class="row">
                        <div class="col-md-6">
                            {{ with .PrevInSection }}
                            <a href="{{ .RelPermalink }}" class="btn btn-outline-primary">
                                <i class="fas fa-chevron-left me-2"></i>Previous: {{ .Title | truncate 30 }}
                            </a>
                            {{ end }}
                        </div>
                        <div class="col-md-6 text-md-end">
                            {{ with .NextInSection }}
                            <a href="{{ .RelPermalink }}" class="btn btn-outline-primary">
                                Next: {{ .Title | truncate 30 }}<i class="fas fa-chevron-right ms-2"></i>
                            </a>
                            {{ end }}
                        </div>
                    </div>
                </nav>

                <!-- Share buttons -->
                <div class="mt-4 pt-4 border-top">
                    <h6>Share this post:</h6>
                    <div class="share-buttons">
                        <a href="https://twitter.com/intent/tweet?text={{ .Title }}&url={{ .Permalink }}"
                           target="_blank" class="btn btn-outline-primary btn-sm me-2">
                            <i class="fab fa-x-twitter me-1"></i>X
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}"
                           target="_blank" class="btn btn-outline-primary btn-sm me-2">
                            <i class="fab fa-facebook me-1"></i>Facebook
                        </a>
                        <a href="https://wa.me/?text={{ .Title }}%20{{ .Permalink }}"
                           target="_blank" class="btn btn-outline-success btn-sm">
                            <i class="fab fa-whatsapp me-1"></i>WhatsApp
                        </a>
                    </div>
                </div>
            </article>
        </div>
    </div>
</div>

<!-- Gallery Modal -->
<div class="modal fade" id="galleryModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Photo Gallery</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" src="" alt="Gallery image" class="img-fluid rounded">
            </div>
        </div>
    </div>
</div>

<script>
function openGalleryModal(imageSrc) {
    document.getElementById('modalImage').src = imageSrc;
    var modalEl = document.getElementById('galleryModal');
    var modal = bootstrap.Modal.getOrCreateInstance(modalEl);
    modal.show();
}

document.addEventListener('DOMContentLoaded', function() {
    var galleryModal = document.getElementById('galleryModal');
    if (galleryModal) {
        galleryModal.addEventListener('hidden.bs.modal', function() {
            document.querySelectorAll('.modal-backdrop').forEach(function(el) { el.remove(); });
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        });
    }

    // Click on any image in post content to open it bigger in the modal
    document.querySelectorAll('.post-content img').forEach(function(img) {
        img.style.cursor = 'pointer';
        img.title = img.title || 'Click to enlarge';
        img.addEventListener('click', function() {
            openGalleryModal(this.currentSrc || this.src);
        });
    });

    // Add smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            var target = document.querySelector(this.getAttribute('href'));
            if (target) {
                e.preventDefault();
                target.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
});
</script>
{{ end }}
